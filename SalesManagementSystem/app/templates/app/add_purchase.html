
{% extends 'app/base.html' %}
{% load static %}
{% load custome_filter %}
{% block title %} 
Orders
{% endblock %}
{% block body %}
            <!-- ============================================================== -->
            <!-- Start Page Content here -->
            <!-- ============================================================== -->
            <style>
                .scrollable-table {
                    max-height: 400px; /* Set the maximum height for the table */
                    overflow-y: auto; /* Add vertical scrollbar when content overflows */
                }
                #id_party{
                    display: block;
                    width: 100%;
                    padding: 0.45rem 0.9rem;
                    font-size: .9rem;
                    font-weight: 400;
                    line-height: 1.5;
                    color: var(--ct-body-color);
                    background-color: var(--ct-input-bg);
                    background-clip: padding-box;
                    border: var(--ct-border-width) solid var(--ct-border-color);
                    -webkit-appearance: none;
                    -moz-appearance: none;
                    appearance: none;
                    border-radius: 0.25rem;
                    -webkit-transition: border-color .15s ease-in-out,-webkit-box-shadow .15s ease-in-out;
                    transition: border-color .15s ease-in-out,-webkit-box-shadow .15s ease-in-out;
                    transition: border-color .15s ease-in-out,box-shadow .15s ease-in-out;
                    transition: border-color .15s ease-in-out,box-shadow .15s ease-in-out,-webkit-box-shadow .15s ease-in-out;
                }
                #id_product{
                    display: block;
                    width: 100%;
                    padding: 0.45rem 0.9rem;
                    font-size: .9rem;
                    font-weight: 400;
                    line-height: 1.5;
                    color: var(--ct-body-color);
                    background-color: var(--ct-input-bg);
                    background-clip: padding-box;
                    border: var(--ct-border-width) solid var(--ct-border-color);
                    -webkit-appearance: none;
                    -moz-appearance: none;
                    appearance: none;
                    border-radius: 0.25rem;
                    -webkit-transition: border-color .15s ease-in-out,-webkit-box-shadow .15s ease-in-out;
                    transition: border-color .15s ease-in-out,-webkit-box-shadow .15s ease-in-out;
                    transition: border-color .15s ease-in-out,box-shadow .15s ease-in-out;
                    transition: border-color .15s ease-in-out,box-shadow .15s ease-in-out,-webkit-box-shadow .15s ease-in-out;
                }
                #id_unit{
                    display: block;
                    width: 100%;
                    padding: 0.45rem 0.9rem;
                    font-size: .9rem;
                    font-weight: 400;
                    line-height: 1.5;
                    color: var(--ct-body-color);
                    background-color: var(--ct-input-bg);
                    background-clip: padding-box;
                    border: var(--ct-border-width) solid var(--ct-border-color);
                    -webkit-appearance: none;
                    -moz-appearance: none;
                    appearance: none;
                    border-radius: 0.25rem;
                    -webkit-transition: border-color .15s ease-in-out,-webkit-box-shadow .15s ease-in-out;
                    transition: border-color .15s ease-in-out,-webkit-box-shadow .15s ease-in-out;
                    transition: border-color .15s ease-in-out,box-shadow .15s ease-in-out;
                    transition: border-color .15s ease-in-out,box-shadow .15s ease-in-out,-webkit-box-shadow .15s ease-in-out;
                }
            </style>
            
            <from metho="post" action="">
            <div class="content-page">
                <div class="content">

                    <!-- Start Content-->
                    <div class="container-fluid">

                        <!-- start page title -->
                        <div class="row">
                            <div class="col-12">
                                <div class="page-title-box">
                                    <div class="page-title-right">
                                        <ol class="breadcrumb m-0">
                                            <li class="breadcrumb-item"><a href="javascript: void(0);">Hyper</a></li>
                                            <li class="breadcrumb-item"><a href="javascript: void(0);">eCommerce</a></li>
                                            <li class="breadcrumb-item active">Orders</li>
                                        </ol>
                                    </div>
                                    <h4 class="page-title">Create Purchase</h4>
                                </div>
                            </div>
                        </div>
                        <!-- end page title -->

                        <div class="row">
                            <div class="col-md-12">
                                <div class="card">
                                    <div class="card-body" >
                                        
                                     
                                 
                                        <div class="tab-content">

                                            <!-- Billing Content-->
                                            <div class="tab-pane show active" id="customer">
                           
                                             <div class="row">
                                                <div class="col-lg-12">
                                                    <h4 class="mt-2">PURCHASE DETAILS</h4>
    
    
                                                    {% if messages %}
                                                        {% for msg in messages %}
                                                            <div class="alert alert-{{ msg.tags }} alert-dismissible text-bg-{{ msg.tags }} border-0 fade show" role="alert">
                                                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="alert" aria-label="Close"></button>
                                                                <strong>{% if msg.tags == 'success' %}Success{% elif msg.tags == 'warning' %}Warning{% endif %} - </strong>{{ msg.message }}
                                                            </div>
                                                        {% endfor %}
                                                    {% endif %}
                                                    <br>
                                                        <form  method="post" action="{% url 'app:addpurchase' %}">
                                                            {% csrf_token %}
                                                            <div class="row">
                                                                <div class="col-md-3">
                                                                    <div class="mb-3">
                                                                        <label for="billing-first-name" class="form-label">Party Name<span class="text-danger">*</span></label>
                                                                        <br>
                                                                        {{pruchaseform.party}}
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-3">
                                                                    <div class="mb-3">
                                                                        <label for="billing-phone" class="form-label">Product <span class="text-danger">*</span></label>
                                                                        <br>
                                                                        {{purchaseItem.product}}
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-2">
                                                                    <div class="mb-3">
                                                                        <label for="billing-unit" class="form-label">Unit <span class="text-danger">*</span></label><br>
                                                                        {{purchaseItem.unit}}
                                                                    </div>
                                                                </div>

                                                                <div class="col-md-2">
                                                                    <div class="mb-3">
                                                                        <label for="billing-quantity" class="form-label">Quantity <span class="text-danger">*</span></label>
                                                                        <input class="form-control" name="{{purchaseItem.quantity.name}}" type="number" value="1" placeholder="Quantity" id="billing-quantity" required />
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-2">
                                                                    <div class="mb-3">
                                                                        <label for="billing-price" class="form-label">Per-Unit Price <span class="text-danger">*</span> </label>
                                                                        <input class="form-control" name="{{purchaseItem.amount_per_unit.name}}" type="number" value="10" placeholder="Enter price" id="billing-price" required />
                                                                    </div>
                                                                </div>

                                                            </div> <!-- end row -->
                                                            <center>
                                                                <button type="submit" class="btn btn-success">Add Purchase</button>
                                                            </center>
                                                        </form> 


                                                        <!-- purchase_form.html -->

                                                    {% comment %} <form method="post" action="{% url 'app:addpurchase' %}">
                                                        {% csrf_token %}
                                                        <div class="row d-flex">
                                                            <div class="col-md-4">
                                                                <div class="mb-3">
                                                                    <label for="billing-first-name" class="form-label">Party Name<span class="text-danger">*</span></label>
                                                                    <br>
                                                                    {{purchase_form.party}}
                                                                </div>
                                                            </div>
                                                            <div class="col-md-4">
                                                                <div class="mb-3">
                                                                    <label for="billing-phone" class="form-label">Total <span class="text-danger">*</span></label>
                                                                    <input class="form-control" name="{{purchase_form.total_amount.name}}" type="number" placeholder="total" id="billing-phone" required/>
                                                                </div>
                                                            </div>
                                                            <div class="col-md-4">
                                                                <div class="mb-3">
                                                                    <label for="billing-unit" class="form-label">Bill No <span class="text-danger">*</span></label>
                                                                    <input class="form-control" name="{{purchase_form.bill_no.name}}" type="number" value="1" placeholder="unite" id="billing-quantity" required />
                                                                </div>
                                                            </div>


                                                        </div>

                                                        <fieldset>
                                                        <legend>Purchase Items</legend>
                                                        {{ purchase_item_formset.management_form }}
                                                        {{ purchase_item_formset.non_form_errors }}
                                                        <div id="formset-items">
                                                        {% for item in purchase_item_formset %}
                                                        <div class="row ">
                                                            <div class="col-md-3">
                                                                <div class="mb-3">
                                                                    <label for="billing-first-name" class="form-label">Product Name<span class="text-danger">*</span></label>
                                                                    <br>
                                                                    {{item.product}}
                                                                </div>
                                                            </div>
                                                            <div class="col-md-2">
                                                                <div class="mb-3">
                                                                    <label for="billing-phone" class="form-label">Unit <span class="text-danger">*</span></label>
                                                                    <br>
                                                                    {{item.unit}}
                                                                </div>
                                                            </div>
                                                            <div class="col-md-2">
                                                                <div class="mb-3">
                                                                    <label for="billing-unit" class="form-label">Amount_per_unit <span class="text-danger">*</span></label>
                                                                    <input class="form-control" name="{{item.amount_per_unit.name}}" type="number" value="1" placeholder="unite" id="billing-quantity" required />
                                                                </div>
                                                            </div>
                                                            <div class="col-md-2">
                                                                <div class="mb-3">
                                                                    <label for="billing-unit" class="form-label">quantity <span class="text-danger">*</span></label>
                                                                    <input class="form-control" name="{{item.quantity.name}}" type="number" value="1" placeholder="unite" id="billing-quantity" required />
                                                                </div>
                                                            </div>
                                                            <div class="col-md-3">
                                                                <div class="mb-3">
                                                                    <label for="billing-expired-date" class="form-label">Expired Date <span class="text-danger">*</span></label>
                                                                    <input class="form-control" name="{{item.expired_date.name}}" type="date"  placeholder="expired_date" id="billing-expired-date" required />
                                                                </div>
                                                            </div>

          


                                                        </div>
                                                        
                                                        {% endfor %}
                                                        <button type="button" id="additem" class="btn btn-primary">Add Another</button>

                                                        </div>
                                                        </fieldset>
                                                        <br>
                                                        <button type="submit" class="btn btn-success">Submit</button>

                                                    </form> {% endcomment %}
                                                </div>
                                                 
                                            </div> <!-- end row-->
                                            
                                    </div>
                                    <div>
                                        
                                    </div>
                                       <!-- Shipping Content-->
                                    
                                    </div>
                                    <!-- End Shipping Information Content-->
                           
                                  
                                    </div> <!-- end card-body-->

                                </div> <!-- end card-->
                                
                            </div> <!-- end col -->
                           


                        </div>
                        
                        
                        <!-- end row --> 
                       

               
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-12">
                                        <b> Purchase Items</b>
                                        <div class="table-responsive scrollable-table">
                                            <table class="table table-borderless table-nowrap table-centered mb-0">
                                                <thead class="table-light">
                                                    <tr>
                                                        <th>S.N</th>
                                                        <th>Date</th>
                                                        <th>Party<th>
                                                        <th>Product</th>
                                                        <th>Per Unit Price</th>
                                                        <th>Quantity</th>
                                                        <th>Total</th>
                                                        {% comment %} <th style="width: 50px;">Action</th> {% endcomment %}
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {% for item in purchase_data%}
                                                    <tr>
                                                        <td>{{forloop.counter}}</td>
                                                        <td>{{item.nepali_create_date}}</td>
                                                        <td>
                                                            <a href="" class="text-body">{{item.party}}</a>
                                                        </td>
                                                        <td></td>
                                                        <td>
                                                            <ul>
                                                                {% for product in item.purchase.all %}
                                                                    <li >
                                                                        {{product.product}}
                                                                        
                                                                    </li>
                                                                {% endfor %}
                                                            </ul>
                                                        </td>
                                                        <td>
                                                            <ul>
                                                                {% for product in item.purchase.all %}
                                                                    <li >
                                                                        {{product.amount_per_unit}}
                                                                        
                                                                    </li>
                                                                {% endfor %}
                                                            </ul>
                                                        </td>
                                                        <td>
                                                            <ul>
                                                                {% for product in item.purchase.all %}
                                                                    <li >
                                                                        {{product.quantity}}
                                                                        
                                                                    </li>
                                                                {% endfor %}
                                                            </ul>
                                                        </td>
                                                        <td>
                                                            <ul>
                                                                {% for product in item.purchase.all %}
                                                                    <li >
                                                                        Rs.{{ product.quantity | multiply:product.amount_per_unit }}
                                                                        
                                                                    </li>
                                                                {% endfor %}
                                                            </ul>
                                                        </td>
                                                        {% comment %} <td>
                                                            <a href="javascript:void(0);" class="action-icon"> <i
                                                                    class="mdi mdi-delete"></i></a>
                                                        </td> {% endcomment %}
                                                    </tr>
                                                    {% endfor %}
                                                    
                                                </tbody>
                                            </table>
                                        </div> <!-- end table-responsive-->

                                       
                                       
                                    </div>
                                    <!-- end col -->

                                </div> <!-- end row -->
                            </div> <!-- end card-body-->
                        </div> <!-- end card-->
                    </div> <!-- end col -->


                    <script>
                        // JavaScript to handle adding new formset items
                        const addButton = document.getElementById('additem');
                        const formsetItems = document.getElementById('formset-items');
                        let formsetItemCount = {{ purchase_item_formset.management_form.total_forms.value }};
                        
                        addButton.addEventListener('click', () => {
                            console.log("Button clicked");
                            // Rest of your code
                          });

                        addButton.addEventListener('click', () => {
                          const formHtml = '{{ purchase_item_formset.empty_form.as_table }}'.replace(/__prefix__/g, formsetItemCount);
                          const formWrapper = document.createElement('div');
                          formWrapper.classList.add('formset-item');
                          formWrapper.innerHTML = formHtml;
                          
                          // Increment the form count and update the formset management form
                          formsetItemCount++;
                          const totalFormsInput = document.querySelector('#id_purchaseitem_set-TOTAL_FORMS');
                          totalFormsInput.value = formsetItemCount;
                      
                          formsetItems.appendChild(formWrapper);
                        });
                      </script>
                      
                      
{% endblock %}