
{% extends 'app/base.html' %}
{% load static %}
{% block title %} 
Orders
{% endblock %}
{% block body %}
            <!-- ============================================================== -->
            <!-- Start Page Content here -->
            <!-- ============================================================== -->
            <style>
                .scrollable-table {
                    max-height: 400px; /* Set the maximum height for the table */
                    overflow-y: auto; /* Add vertical scrollbar when content overflows */
                }
                #id_customer{
                    display: block;
                    width: 100%;
                    padding: 0.45rem 0.9rem;
                    font-size: .9rem;
                    font-weight: 400;
                    line-height: 1.5;
                    color: var(--ct-body-color);
                    background-color: var(--ct-input-bg);
                    background-clip: padding-box;
                    border: var(--ct-border-width) solid var(--ct-border-color);
                    -webkit-appearance: none;
                    -moz-appearance: none;
                    appearance: none;
                    border-radius: 0.25rem;
                    -webkit-transition: border-color .15s ease-in-out,-webkit-box-shadow .15s ease-in-out;
                    transition: border-color .15s ease-in-out,-webkit-box-shadow .15s ease-in-out;
                    transition: border-color .15s ease-in-out,box-shadow .15s ease-in-out;
                    transition: border-color .15s ease-in-out,box-shadow .15s ease-in-out,-webkit-box-shadow .15s ease-in-out;
                }
            </style>
            
            <div class="content-page">
                <div class="content">

                    <!-- Start Content-->
                    <div class="container-fluid">

                        <!-- start page title -->
                        <div class="row">
                            <div class="col-12">
                                <div class="page-title-box">
                                    <div class="page-title-right">
                                        <ol class="breadcrumb m-0">
                                            <li class="breadcrumb-item"><a href="javascript: void(0);">Sales Management System</a></li>
                                            <li class="breadcrumb-item"><a href="javascript: void(0);">Add Sales</a></li>
                                        </ol>
                                    </div>
                                    <h4 class="page-title">Create Sales</h4>
                                </div>
                            </div>
                        </div>
                        <!-- end page title -->

                        <form method ="post" action="{% url 'app:addsales' %}">
                        {% csrf_token %}
                       {% comment %} {% if cartItems %} {% endcomment %}
                        <div class="row">
                           
                            <div class="col-md-12">
                                {% if cartItems %}
                                <div class="card">
                                    <div class="card-body" >
                                        <div class="tab-content">

                                            <!-- Billing Content-->
                                            <div class="tab-pane show active" id="customer">
                                            
                                             <div class="row">
                                                <div class="col-lg-12">
                                                    <h4 class="mt-2">CUSTOMER DETAILS</h4>
                                                    {% if form.errors %}
                                                        <ul class="errorlist">
                                                            {% for field in form %}
                                                                {% for error in field.errors %}
                                                                    <li>{{ error }}</li>
                                                                {% endfor %}
                                                            {% endfor %}
                                                        </ul>
                                                    {% endif %}

                                                    {% if customerdetails %}
                                                    <div class="row">
                                                        <div class="col-md-6">
                                                            <div class="mb-3">
                                                                <label for="billing-first-name" class="form-label">Customer Name<span class="text-danger">*</span></label>
                                                                {% comment %} {{form.customer}} {% endcomment %}
                                                                <select class="form-control" name="customer" readonly>
                                                                    {% for option in form.customer.field.choices %}
                                                                        {% if option.0 == customerdetails.id %}
                                                                            <option value="{{ option.0 }}" selected>{{ option.1 }}</option>
                                                                        {% comment %} {% else %}
                                                                            <option value="{{ option.0 }}">{{ option.1 }}</option> {% endcomment %}
                                                                        {% endif %}
                                                                    {% endfor %}
                                                                </select>
                                                                {% comment %} <input class="form-control" name="{{form.customer.name}}" type="text" value="{{ customerdetails.name}}" readonly required> {% endcomment %}

                                                                
                                                            </div>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <div class="mb-3">
                                                                <label for="billing-phone" class="form-label">Phone Number <span class="text-danger">*</span></label>
                                                                <input class="form-control" name="{{form.phone_number.name}}" type="text" value="{{customerdetails.phone_number}}" placeholder="(xx) xxx xxxx xxx" id="billing-phone" readonly required/>
                                                            </div>
                                                        </div>
                                                    </div> <!-- end row -->
                                                    <div class="row">
                                                        <div class="col-md-6">
                                                            <div class="mb-3">
                                                                <label for="billing-phone" class="form-label">Party Address <span class="text-danger">*</span></label>
                                                                <input class="form-control" name="{{form.address.name}}" type="text" value="{{customerdetails.address}}" placeholder="Address" id="billing-address" readonly required />
                                                            </div>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <div class="mb-3">
                                                                <label for="billing-email-address" class="form-label">Email Address (option)</label>
                                                                <input class="form-control" name="{{form.email.name}}" type="email" value="{{customerdetails.email}}" placeholder="Enter your email" id="billing-email" readonly />
                                                            </div>
                                                        </div>
                                                        
                                                    </div> <!-- end row -->
                                                    {% else %}
                                                    <div class="row">
                                                        <div class="col-md-6">
                                                            <div class="mb-3">
                                                                <label for="billing-first-name" class="form-label">Customer Name<span class="text-danger">*</span></label>
                                                                {{form.customer}}
                                                                
                                                            </div>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <div class="mb-3">
                                                                <label for="billing-phone" class="form-label">Phone Number <span class="text-danger">*</span></label>
                                                                <input class="form-control" name="{{form.phone_number.name}}" type="text" placeholder="(xx) xxx xxxx xxx" id="billing-phone" required/>
                                                            </div>
                                                        </div>
                                                    </div> <!-- end row -->
                                                    <div class="row">
                                                        <div class="col-md-6">
                                                            <div class="mb-3">
                                                                <label for="billing-phone" class="form-label">Party Address <span class="text-danger">*</span></label>
                                                                <input class="form-control" name="{{form.address.name}}" type="text" placeholder="Address" id="billing-address" required />
                                                            </div>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <div class="mb-3">
                                                                <label for="billing-email-address" class="form-label">Email Address (option)</label>
                                                                <input class="form-control" name="{{form.email.name}}" type="email" placeholder="Enter your email" id="billing-email" />
                                                            </div>
                                                        </div>
                                                        
                                                    </div> <!-- end row -->
                                                    {% endif %}
                                                </div>
                                                 
                                            </div>
                                           
                                            <!-- end row-->
                                            
                                    </div>
                                    <div>
                                        
                                    </div>
                                       <!-- Shipping Content-->
                                    
                                    </div>
                                    <!-- End Shipping Information Content-->
                           
                                  
                                    </div> <!-- end card-body-->

                                </div> <!-- end card-->
                                
                            </div> <!-- end col -->
                            {% comment %} <div class="col-md-3 ">
                                <div class="card">
                                    <div class="card-body">
                      
                                        <div class="tab-content">

                                            <!-- Billing Content-->
                                            <div class="tab-pane show active" id="customer">
                           
                                             <div class="row">
                                                <div class="col-lg-12">
                                                    <h4 class="mt-2">INVOICE DETAILS </h4>
                                                        <div class="row">
                                                            <div class="col-md-12">
                                                                <div class="mb-3">
                                                                    <label for="billing-first-name" class="form-label">Invoice Number</label>
                                                                    <input class="form-control" type="number" name="{{form.bill_no.name}}" placeholder="enter number" id="billing-first-name" />
                                                                </div>
                                                            </div>
                                                            
                                                        </div> <!-- end row -->
                                                        <div class="row">
                                                            <div class="col-md-12">
                                                                <div class="mb-3">
                                                                    <label for="billing-last-name" class="form-label">Invoice Date </label>
                                                                    <input type="text" name="{{form.created_date.name}}" class="form-control form-control-light" id="dash-daterange">

                                                                </div>
                                                            </div>
                                                        </div> <!-- end row -->
                                                    
                                                </div>
                                                 
                                            </div> <!-- end row-->
                                            
                                    </div>
                                       <!-- Shipping Content-->
                                    
                                    </div>
                                    <!-- End Shipping Information Content-->                                    
                                    </div> <!-- end card-body-->
                                </div> <!-- end card-->
                            </div> <!-- end col -->

                            <div class="col-md-3 ">
                                <div class="card">
                                    <div class="card-body">
                      
                                        <div class="border pt-2 mt-4 mt-lg-0 rounded">
                                            <h4 class="header-title mb-3 ps-2">Order Summary</h4>

                                            <div class="">
                                                <table class="table mb-0">
                                                    <tbody>
                                                        <tr>
                                                            <td>Grand Total :</td>
                                                            <td>$1571.19</td>
                                                        </tr>
                                                        <tr>
                                                            <th>Total :</th>
                                                            <th>$1458.3</th>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                            <!-- end table-responsive -->
                                        </div> 
                                    </div>
                                    <div>
                                        
                                    </div>
                                       <!-- Shipping Content-->
                                    
                                    </div>
                                    <!-- End Shipping Information Content-->                                   
                                 </div> <!-- end card-body-->
                                </div> <!-- end card-->
                            </div> {% endcomment %}


                        </div>
                        {% endif %}
                        {% comment %} {% endif %} {% endcomment %}
                        
                        
                        <!-- end row --> 
                       

                    
                        <div class="row">
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-12">
                                                <b>SALS ITEMS</b>
                                                <div class="table-responsive scrollable-table">
                                                    <table class="table table-borderless table-nowrap table-centered mb-0">
                                                        <thead class="table-light">
                                                            <tr>
                                                                <th>Product</th>
                                                                <th>Price</th>
                                                                <th>Quantity</th>
                                                                <th>Unite</th>
                                                                <th>Action</th>
                                                                <th style="width: 50px;"></th>
                                                            </tr>
                                                        </thead>
                                                        <tbody id="items">
                                                            {% for item in cartItems%}
                                                                

                                                                <tr>
                                                                    <input type="hidden" name="id{{item.id}}" value="{{item.id}}">
                                                                    
                                                                    <td>
                                                                        <img src="{% if item.obj.image %} {{item.obj.image.url}} {% else %} {% static 'app/assets/unknow.png' %} {% endif %}" alt="contact-img" name="image{{item.id}}"
                                                                            title="contact-img" class="rounded me-3" style="height:50px; width:100px; object-fit:cover;" />
                                                                        <p class="m-0 d-inline-block align-middle font-16">
                                                                            <a href="apps-ecommerce-products-details.html"
                                                                                class="text-body">{{item.obj.product_name}}</a>
                                                                            <br>
                                                                        </p>
                                                                    </td>
                                                                    <td>
                                                                        <input class="form-control"  type="number" id="price" name="price{{ item.id }}"  placeholder="Enter price" required>
                                                                    </td>
                                                                    <td>
                                                                        <input type="number" min="1" value="1" id="qty" name="quantity{{ item.id }}" class="form-control"
                                                                            placeholder="Qty" style="width: 90px;" step="0.1" min="0.1" required>
                                                                    </td>
                                                                    <td>
                                                                        <select name="unite{{ item.id }}" id="" class="form-control" >
                                                                            {% for unite in units %}
                                                                            <option value="{{unite.id}}">{{unite.unit_name}}</option>
                                                                            {% endfor %}
                                                                            
                                                                        </select>
                                                                    </td>
                                                                    {% comment %} <td>
                                                                        <input class="form-control"  type="number" id="total" name="total-price{{ item.id }}" placeholder="Enter price" required>
                                                                    </td> {% endcomment %}
                                                                    <td>  
                                                                        {% comment %} <div class="action-icon btn ps-2 pe-2 delete_cart_item" data-product-id="{{ item.id }}">
                                                                            <i class="mdi mdi-delete"></i>
                                                                        </div> {% endcomment %}

                                                                        <button  type="button" class="btn" data-bs-toggle="modal" data-bs-target="#delete_seleted_product-{{item.id}}"><i class="mdi mdi-delete"></i></button>

                                                                    </td>
                                                                </tr>
                                                                {% empty %}
                                                                <tr>
                                                                    <h5>There are no items in this list.</h5>
                                                                </tr>

                                                                {% endfor %}
                                                        </tbody>
                                                    </table>
                                                   
                                                </div> <!-- end table-responsive-->

                                                <!-- payment method -->
                                               <div class="row bg-light pb-3 m-1">
                                                    
                                                
                                                    <div class="fs-4 text-bold pt-3">
                                                       <b>PAID VIA</b>
                                                    </div>
                                                    <br>
                                                    <div class=" d-flex pt-2">
                                                        {% comment %} <input type="radio" id="paid" name="payment_status"  value="paid">
                                                        <label for="fullpaid" class="pe-4 ps-1">Paid</label><br> {% endcomment %}
                                                        {% comment %} <input type="radio" id="partiallypaid" name="payment_status"  value="partially_paid">
                                                        <label for="partiallypaid" class="pe-4 ps-1">Partially Paid</label><br> {% endcomment %}
                                                        <input type="radio" id="unpaid" name="payment_status" value="unpaid" checked>
                                                        <label for="javascript" class="ps-1">Unpaid</label><br>
                                                
                                                    </div>
                                                    <div id="inputContainer" class="pt-2" style="display:none; width:280px;">
                                                        <input type="number" name="partially_paid_amount" class="form-control" id="textInput" placeholder="Enter price">
                                                    </div>
                                               </div>
                                                <br>
                                                <center>
                                                    <div class="flex p-3 justify-content-between bg-dark ">
                                                        <a class="btn btn-outline-primary float-centerr"  data-bs-toggle="offcanvas" data-bs-target="#selecitem" aria-controls="offcanvasRight"><i class="mdi mdi-plus"></i> Select Item </a>
                                                        {% if cartItems %}
                                                        <button type="submit" class="btn btn-outline-success float-center" name="submit" id="submit" >Create Sales</button>
                                                        {% endif %}
                                                    </div>
                                                </center>
                                            
                                            
                                            </div>
                                            <!-- end col -->

                                        </div> <!-- end row -->
                                    </div> <!-- end card-body-->
                                </div> <!-- end card-->
                            </div> <!-- end col -->
                        </div>
                        <!-- end row -->

                    </form>

                <!-- add item -->
                <div class="offcanvas offcanvas-end" tabindex="-1" id="selecitem" aria-labelledby="offcanvasRightLabel" style="width: 500px;">
                    <div class="offcanvas-header">
                      <h5 class="offcanvas-title" id="offcanvasRightLabel">Products</h5>
                      <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
                    </div>
                    <div class="offcanvas-body">
                      <!-- ... -->

                      <div class="row">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-body">

                                 
                                    <!-- Steps Information -->
                                    <div class="tab-content">

                                        <!-- Billing Content-->
                                        <div class="tab-pane show active" id="billing-information">
                                            <div class="row">
                                                <div class="col-lg-12">
                                                    <form method="post" action ="#" enctype="multipart/form-data">
                                                        {% csrf_token %}
                                                        <input type="hidden" name="form_type" value="">
                                                        <div class="row">
                                                            <div class="col-md-8">
                                                                <div class="mb-3">
                                                                    <input name='search' class="form-control" type="text" placeholder="search products...." id="billing-first-name" />
                                                                </div>
                                                            </div>
                                                            <div class="col-md-4">
                                                                <div class="mb-3">
                                                                    <div class="btn btn-danger">Search</div>
                                                                </div>
                                                            </div>
                                                        </div> <!-- end row -->
                                                    </form>
                                                    <div class="table-responsive scrollable-table">
                                                        <table class="table table-borderless table-nowrap table-centered mb-0">
                                                            <thead class="table-light ">
                                                                <tr>
                                                                    <th>Product</th>
                                                                    <th style="width: 50px;"></th>
                                                                </tr>
                                                            </thead>
                                                            <tbody>
                                                                
                                                                {% for product in products %}
                                                                <form method="post" action="{% url 'app:add_to_cart' %}">
                                                                {% csrf_token %}
                                                                <input type="hidden" name="customerId" value="{% if customerdetails %} {{customerdetails.id}} {% endif %}">
                                                                <tr>
                                                                    <td>
                                                                        <img src="{% if product.image %}{{ product.image.url }} {% else %} {% static 'app/assets/unknow.png' %} {% endif %}" alt="product-image" title="product-image" class="rounded me-3" style="height:64px; width:100px; object-fit:cover;" />
                                                                        <p class="m-0 d-inline-block align-middle font-16">
                                                                            <a href="apps-ecommerce-products-details.html" class="text-body">{{ product.product_name }}</a>
                                                                        </p>
                                                                    </td>
                                                                    <input type="hidden" name="product_id" value="{{product.id}}">
                                                                    <td>
                                                                        {% comment %} <div class="action-icon btn btn-danger ps-2 pe-2 add-to-cart" data-product-id="{{ product.id }}">
                                                                            <span class="fs-4 text-white" style="font-family: times-new-roman; font-weight: 10px;">Add</span>
                                                                        </div> {% endcomment %} 
                                                                        <button type="submit" class="action-icon btn btn-danger ps-2 pe-2 add-to-cart text-white" style="font-family: times-new-roman; font-weight: 10px;">Add</button>
                                                                    </td>
                                                                </tr>
                                                                </form>
                                                                {% endfor %}
                                                            
                                                                
                                                            </tbody>
                                                        </table>
                                                    </div>

                                                </div>
                                                 
                                            </div> <!-- end row-->
                                        </div>
                                        <!-- End Billing Information Content-->


                                   

                                    </div> <!-- end tab content-->

                                </div> <!-- end card-body-->
                            </div> <!-- end card-->
                        </div> <!-- end col -->
                    </div>
                    <!-- end row-->
                    </div>
                </div>


                <!-- delete selected item -->
                {% for item in products %}
                <div id="delete_seleted_product-{{item.id}}" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="danger-header-modalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-sm">
                        <form method ="post" action="{% url 'app:delete_cart_item' %}">
                            {% csrf_token %}
                        <div class="modal-content">
                            <input type="hidden" value="{{item.id}}" name="id">
                            <input type="hidden" name="customerId" value="{% if customerdetails %} {{customerdetails.id}} {% endif %}">
                            <div class="modal-header bg-danger">
                                <h4 class="modal-title text-white" id="danger-header-modalLabel">Delete Items</h4>
                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-hidden="true"></button>
                            </div>
                            <div class="modal-body">
                                Are your Sure ! for deleting these Product ?
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-light" data-bs-dismiss="modal">Close</button>
                                <button type="submit" class="btn btn-danger">Yes</button>
                            </div>

                        </div><!-- /.modal-content -->
                        </form>
                    </div><!-- /.modal-dialog -->
                </div>
                {% endfor %}


                <!-- ajax section -->
                <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>
                {% comment %} <script>
                    $(document).ready(function() {
                        $(".add-to-cart").click(function() {
                            var url = "{% url 'app:add_to_cart' %}";
                            var product_id = $(this).data('product-id'); // Get the product ID from the data attribute

                            $.ajax({
                                type: "GET", // You can use "POST" if needed
                                url: url,
                                data: {
                                    'product_id': product_id
                                },
                                success: function(data) {
                                    console.log(data.message); // Log the message from the server items
                                    console.log(data.items)
                                    //$("#items").html(data);

                                    
                                },
                                error: function(xhr, textStatus, errorThrown) {
                                    console.log("Error:", textStatus, errorThrown);
                                }
                            });
                        });
                    });
                </script> {% endcomment %}
                {% comment %} <script>
                    $(document).ready(function() {
                        
                        $(".delete_cart_item").click(function() {
                            var url = "{% url 'app:delete_cart_item' %}";
                            var product_id = $(this).data('product-id'); // Get the product ID from the data attribute
                
                            $.ajax({
                                type: "GET", // You can use "POST" if needed
                                url: url,
                                data: {
                                    'product_id': product_id
                                },
                                success: function(data) {
                                    console.log(data.message); // Log the message from the server items
                                    console.log(data.items)
                                    $("#items").html(data);
                                    
                                },
                                error: function(xhr, textStatus, errorThrown) {
                                    console.log("Error:", textStatus, errorThrown);
                                }
                            });
                        });
                    });
                </script> {% endcomment %}

                <!-- auto fill form-->
                <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
                <script>
                    $(document).ready(function () {
                        $(".txt").each(function() {

                            $(this).keyup(function() {
                              calculateSum();
                            });
                          });


                        // Listen for changes in the user dropdown selection
                        $("#id_customer").on("change", function () {
                            var userId = $(this).val();
                            if (userId) {
                                $.ajax({
                                    url: "{% url 'app:get_user_detail' %}",  // Replace with the actual URL for fetching user data
                                    method: 'GET',
                                    data: { user_id: userId },
                                    success: function (data) {
                                        console.log("data", data);
                                        
                                        var items = JSON.parse(data.items);
                                        
                                        $("#billing-phone").val(items.phone_number);
                                        $("#billing-address").val(items.address);
                                        $("#billing-email").val(items.email);
                                    },
                                    error: function (error) {
                                        console.log(error);
                                    }
                                });
                            }
                        });
                    });
                </script>

                <script>
                    const partiallypaid = document.getElementById('partiallypaid');
                    const paid = document.getElementById('paid');
                    const unpaid = document.getElementById('unpaid');
                    const inputContainer = document.getElementById('inputContainer');
            
                    partiallypaid.addEventListener('change', toggleInput);
                    paid.addEventListener('change', toggleInput);
                    unpaid.addEventListener('change', toggleInput);
            
                    function toggleInput() {
                        if (partiallypaid.checked) {
                            inputContainer.style.display = 'block';
                        } else {
                            inputContainer.style.display = 'none';
                        }
                    }
                </script>



       {%endblock%}